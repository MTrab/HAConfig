- id: '1602097080450'
  alias: Auto - Turn on Vitrine when sun goes down
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
    from: above_horizon
    to: below_horizon
  condition:
  - condition: state
    entity_id: group.any_home
    state: home
  action:
  - type: turn_on
    device_id: 3246c312f9e0e5220c923e523158141e
    entity_id: light.vitrine
    domain: light
    brightness_pct: 100
  mode: single
- id: '1602155183627'
  alias: Light - Livingroom - Desktop Switch
  description: ''
  trigger:
  - device_id: 0c217534fa16479f6fe7d4c595edea3d
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
    id: desktop_on
  - device_id: 0c217534fa16479f6fe7d4c595edea3d
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_off
    id: desktop_off
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: desktop_on
      sequence:
      - service: light.turn_on
        data: {}
        target:
          entity_id: light.desktop
    - conditions:
      - condition: trigger
        id: desktop_off
      sequence:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.desktop
    default: []
  mode: queued
  max: 10
- id: '1602228352429'
  alias: Auto - Set TV volume
  description: ''
  trigger:
  - platform: state
    entity_id:
    - media_player.android_tv
    attribute: app_name
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.android_tv
        state: Twitch
        attribute: app_name
      sequence:
      - service: media_player.volume_set
        target:
          entity_id: media_player.stue
        data:
          volume_level: 0.05
    default:
    - delay:
        hours: 0
        minutes: 0
        seconds: 5
        milliseconds: 0
    - service: media_player.volume_set
      target:
        entity_id: media_player.stue
      data:
        volume_level: 0.12
  mode: restart
- id: '1602610466182'
  alias: Auto - Turn on some lights when dark and coming home
  description: ''
  trigger:
  - platform: state
    to: home
    entity_id: person.malene_trab
  - platform: state
    entity_id: device_tracker.kia_niro
    to: home
  condition:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  action:
  - type: turn_on
    device_id: 3246c312f9e0e5220c923e523158141e
    entity_id: light.vitrine
    domain: light
    brightness_pct: 100
  - type: turn_on
    device_id: 80cb35c383ad7ab431957c4800c3573d
    entity_id: light.outside_1
    domain: light
    brightness_pct: 1
  - service: switch.turn_on
    target:
      entity_id: switch.store_stearinlys
    data: {}
  mode: single
- id: '1605100832268'
  alias: State - Toggle away mode
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.away_mode
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.away_mode
        state: 'on'
      sequence:
      - service: homeassistant.turn_off
        target:
          entity_id:
          - switch.schedule_normal_heating
          - switch.schedule_normal_heating_when_working_from_home
          - switch.schedule_weekend_heating
          - input_boolean.allow_auto_charge
          - automation.alert_extra_wakeup_alarm
          - automation.auto_toggle_climate_when_window_opens
          - automation.auto_detect_low_battery_and_notify
          - automation.light_outside_morning_on
          - automation.light_dusk_outside_auto_on
          - automation.auto_set_extra_wakeup_alarm_trigger
          - automation.auto_standby_off
          - automation.turn_on_vitrine_when_sun_goes_down
          - automation.auto_turn_on_candles_when_sun_goes_down
          - automation.auto_webasto_turn_on_at_calculated_start_time
          - automation.light_motion_bathroom
          - automation.light_motion_hall
          - automation.notification_remind_departure
          - automation.vacuum_automate_run_and_dock
          - automation.tts_chatgpt_bedtime
          - automation.tts_chatgpt_departure_time
          - automation.tts_chatgpt_djskoge_streamer
          area_id:
          - gang
          - 8868a58504c411eb945e45ca1102362e
          - 8868a7e204c411eb899463fe073850fb
          - 61bc22cd04e111eb9494c926e661f79b
          - 8868a1b304c411eb9211dd814829b168
          - toilet
          - udendors
          - unnamed_room
        data: {}
      - service: climate.set_temperature
        data:
          temperature: 18
        target:
          device_id:
          - eb8fa3cd070d11eb93e1f3123b152cc3
          - 87754886a3732e6076a5035700c54e72
          - 6b1faa3363ae772e16cf4b7ada3ad64d
      - service: climate.set_temperature
        data:
          temperature: 18
        target:
          entity_id: climate.bedroom
      - service: climate.set_temperature
        data:
          temperature: 20
        target:
          entity_id:
          - climate.hall
          - climate.toilet
    default:
    - service: homeassistant.turn_on
      target:
        entity_id:
        - switch.schedule_normal_heating
        - switch.schedule_normal_heating_when_working_from_home
        - switch.schedule_weekend_heating
        - input_boolean.allow_auto_charge
        - automation.alert_extra_wakeup_alarm
        - automation.auto_toggle_climate_when_window_opens
        - automation.auto_detect_low_battery_and_notify
        - automation.light_outside_morning_on
        - automation.light_dusk_outside_auto_on
        - automation.auto_set_extra_wakeup_alarm_trigger
        - automation.auto_standby_off
        - automation.turn_on_vitrine_when_sun_goes_down
        - automation.auto_turn_on_candles_when_sun_goes_down
        - automation.auto_webasto_turn_on_at_calculated_start_time
        - automation.light_motion_bathroom
        - automation.light_motion_hall
        - automation.notification_remind_departure
        - automation.tts_calendar_notification
        - automation.tts_dinner_reminder
        - automation.tts_doren_er_aben_new
        - automation.tts_greeting_when_coming_home
        - automation.vacuum_automate_run_and_dock
        - automation.tts_chatgpt_bedtime
        - automation.tts_chatgpt_departure_time
        - automation.tts_chatgpt_djskoge_streamer
      data: {}
  mode: single
- id: '1606586819683'
  alias: Auto - Turn off lights if on after 02:00 AM
  description: ''
  trigger:
  - platform: time
    at: 02:00
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id:
      - switch.store_stearinlys
      - light.vitrine
      - light.outside_1
    data: {}
  mode: single
- id: '1608633503593'
  alias: Light - Kitchen - Motion
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 7565b2d2c98ed8355cac357b12cfd5ea
    entity_id: binary_sensor.pir_kitchen
    domain: binary_sensor
  condition:
  - type: is_illuminance
    condition: device
    device_id: 7565b2d2c98ed8355cac357b12cfd5ea
    entity_id: sensor.pir_kitchen_illuminance
    domain: sensor
    below: 45
  - condition: state
    entity_id: group.any_home
    state: home
    alias: Confirm Any At Home
  action:
  - choose:
    - conditions:
      - condition: time
        after: '23:00'
        before: 05:00
        weekday:
        - mon
        - tue
        - wed
        - thu
      sequence:
      - service: light.turn_on
        data:
          brightness_pct: 20
        target:
          entity_id: light.kitchen
      - wait_for_trigger:
        - type: no_motion
          platform: device
          device_id: 7565b2d2c98ed8355cac357b12cfd5ea
          entity_id: binary_sensor.pir_kitchen
          domain: binary_sensor
    - conditions:
      - condition: time
        weekday:
        - fri
        after: '23:59'
        before: 05:00
      sequence:
      - service: light.turn_on
        data:
          brightness_pct: 20
        target:
          entity_id: light.kitchen
      - wait_for_trigger:
        - type: no_motion
          platform: device
          device_id: 7565b2d2c98ed8355cac357b12cfd5ea
          entity_id: binary_sensor.pir_kitchen
          domain: binary_sensor
    - conditions:
      - condition: time
        after: '23:59'
        before: 07:00
        weekday:
        - sat
      sequence:
      - service: light.turn_on
        data:
          brightness_pct: 20
        target:
          entity_id: light.kitchen
      - wait_for_trigger:
        - type: no_motion
          platform: device
          device_id: 7565b2d2c98ed8355cac357b12cfd5ea
          entity_id: binary_sensor.pir_kitchen
          domain: binary_sensor
    - conditions:
      - condition: time
        after: '23:00'
        before: 07:00
        weekday:
        - sun
      sequence:
      - service: light.turn_on
        data:
          brightness_pct: 20
        target:
          entity_id: light.kitchen
      - wait_for_trigger:
        - type: no_motion
          platform: device
          device_id: 7565b2d2c98ed8355cac357b12cfd5ea
          entity_id: binary_sensor.pir_kitchen
          domain: binary_sensor
    default:
    - service: light.turn_on
      data:
        brightness_pct: 100
      target:
        entity_id: light.kitchen
    - wait_for_trigger:
      - type: no_motion
        platform: device
        device_id: 7565b2d2c98ed8355cac357b12cfd5ea
        entity_id: binary_sensor.pir_kitchen
        domain: binary_sensor
        for:
          hours: 0
          minutes: 13
          seconds: 0
  - service: light.turn_off
    target:
      entity_id: light.kitchen
    data:
      transition: 20
  mode: restart
- id: '1611133656102'
  alias: Light - Dartskab
  description: ''
  trigger:
  - type: not_opened
    platform: device
    device_id: 401edc5cb9bb8b099c004a1a31954d41
    entity_id: binary_sensor.dw_dartskab
    domain: binary_sensor
    id: 'off'
  - type: opened
    platform: device
    device_id: 401edc5cb9bb8b099c004a1a31954d41
    entity_id: binary_sensor.dw_dartskab
    domain: binary_sensor
    id: 'on'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - type: turn_off
        device_id: 02452f84e219fd36505c84ee76d66895
        entity_id: light.dartskab
        domain: light
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - type: turn_on
        device_id: 02452f84e219fd36505c84ee76d66895
        entity_id: light.dartskab
        domain: light
        brightness_pct: 100
    default: []
  mode: restart
- id: '1611135152192'
  alias: Auto - Standby power management - Night
  description: Forsøg at minimere standby forbrug
  trigger:
  - platform: time
    at: 01:00:00
    id: 'off'
  - platform: time
    at: 05:00:00
    id: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: script.control_desktop_power_off
        data: {}
    default: []
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: group.any_home
          state: home
        - condition: trigger
          id: 'on'
      sequence:
      - service: switch.turn_on
        data: {}
        target:
          entity_id:
          - switch.skrivebord
          - switch.hifi
    default: []
  mode: single
- id: '1612350036408'
  alias: Auto - Outside Lights - Dusk - Auto On
  description: ''
  trigger:
  - platform: sun
    event: sunset
  condition:
  - condition: state
    entity_id: group.any_home
    state: home
  action:
  - type: turn_on
    device_id: 80cb35c383ad7ab431957c4800c3573d
    entity_id: light.outside_1
    domain: light
    brightness_pct: 1
  mode: single
- id: '1612426582410'
  alias: Auto - Outside Lights - Morning - On
  description: ''
  trigger:
  - platform: time
    at: 05:00
  condition:
  - condition: state
    entity_id: group.any_home
    state: home
  - condition: sun
    before: sunrise
    before_offset: '60'
  action:
  - type: turn_on
    device_id: 80cb35c383ad7ab431957c4800c3573d
    entity_id: light.outside_1
    domain: light
    brightness_pct: 1
  mode: single
- id: '1612426754916'
  alias: Light - Outside - Motion
  description: Køres kun når lyset er tændt
  trigger:
  - type: motion
    platform: device
    device_id: 994b8fc8a7d26661aeeb06db2c67c9bd
    entity_id: b11017756d5fcec64a9225f7b73fe944
    domain: binary_sensor
    id: 'on'
  - type: no_motion
    platform: device
    device_id: 994b8fc8a7d26661aeeb06db2c67c9bd
    entity_id: b11017756d5fcec64a9225f7b73fe944
    domain: binary_sensor
    id: 'off'
  - platform: state
    entity_id:
    - binary_sensor.door_person_occupancy
    from: 'off'
    to: 'on'
    id: 'on'
  - platform: state
    entity_id:
    - binary_sensor.door_person_occupancy
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 3
      seconds: 0
    id: 'off'
  - type: opened
    platform: device
    device_id: f717a0cbeca42322e0440d68a708e8ef
    entity_id: 8218e5d12b3e697845ab7fc4467d1b09
    domain: binary_sensor
    id: 'on'
  - type: not_opened
    platform: device
    device_id: f717a0cbeca42322e0440d68a708e8ef
    entity_id: 8218e5d12b3e697845ab7fc4467d1b09
    domain: binary_sensor
    id: 'off'
    for:
      hours: 0
      minutes: 3
      seconds: 0
  condition:
  - condition: device
    type: is_on
    device_id: 80cb35c383ad7ab431957c4800c3573d
    entity_id: light.outside_1
    domain: light
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - type: turn_on
        device_id: 80cb35c383ad7ab431957c4800c3573d
        entity_id: light.outside_1
        domain: light
        brightness_pct: 100
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - type: turn_on
        device_id: 80cb35c383ad7ab431957c4800c3573d
        entity_id: light.outside_1
        domain: light
        brightness_pct: 1
    default: []
  mode: restart
- id: '1612506618068'
  alias: Auto - Turn off at dawn
  description: ''
  trigger:
  - platform: sun
    event: sunrise
  condition: []
  action:
  - type: turn_off
    device_id: 80cb35c383ad7ab431957c4800c3573d
    entity_id: light.outside_1
    domain: light
  mode: single
- id: '1612785517695'
  alias: Auto - Come and go control
  description: ''
  trigger:
  - platform: state
    entity_id: group.any_home
    from: home
    to: not_home
    for: 00:02:00
    id: 2min
  - platform: state
    entity_id: group.any_home
    id: 30min
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 30
      seconds: 0
  - platform: state
    entity_id:
    - group.any_home
    from: not_home
    to: home
    id: arriving
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 2min
      sequence:
      - service: media_player.media_stop
        entity_id: all
        data: {}
      - device_id: 58ccf7ba65f0fa80f5056863c184485d
        domain: button
        entity_id: 58c6855fb17d264399c4f0c8f7330a7f
        type: press
      - service: homeassistant.turn_off
        data: {}
        target:
          entity_id:
          - light.dartskab
          - light.bedroom_ceiling_1
          - light.bedroom_ceiling_2
          - light.bedside_1
          - light.bedside_2
          - light.deathstar
          - light.bedroom_ceiling
          - light.gang_loftlys
          - light.sengelys
          - light.desktop
          - light.spisebord
          - light.toilet
          - light.vitrine
          - switch.store_stearinlys
          - light.spisebord
          - light.outside_1
          - light.kitchen
      - service: script.control_desktop_power_off
        data: {}
    - conditions:
      - condition: trigger
        id: 30min
      sequence:
      - service: homeassistant.turn_off
        target:
          entity_id:
          - switch.hifi
        data: {}
    - conditions:
      - condition: trigger
        id: arriving
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.away_mode
      - service: homeassistant.turn_on
        data: {}
        target:
          entity_id:
          - switch.skrivebord
          - switch.hifi
      - device_id: 58ccf7ba65f0fa80f5056863c184485d
        domain: button
        entity_id: f09f95203189f7b4df18a64605715888
        type: press
    default: []
  mode: single
- id: '1615284560741'
  alias: Auto - Toilet - Humidity Exhaust
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.toilet_hygrostat
    to: 'on'
    id: 'on'
    from: 'off'
  - platform: state
    entity_id:
    - binary_sensor.toilet_hygrostat
    id: 'off'
    from: 'on'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - type: turn_on
        device_id: 6de9fe6a5eb1d0abb21bd52d06de2f57
        entity_id: switch.toilet_fan
        domain: switch
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - type: turn_off
        device_id: 6de9fe6a5eb1d0abb21bd52d06de2f57
        entity_id: switch.toilet_fan
        domain: switch
  mode: single
- id: '1615289935324'
  alias: Light - Hall - Motion
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 24ba3139aa039e754aa5e126a868c1f5
    entity_id: binary_sensor.pir_hall
    domain: binary_sensor
  condition:
  - type: is_illuminance
    condition: device
    device_id: 24ba3139aa039e754aa5e126a868c1f5
    entity_id: sensor.pir_hall_illuminance
    domain: sensor
    below: 130
  - condition: state
    entity_id: group.any_home
    state: home
    alias: Confirm Any At Home
  action:
  - service: light.turn_on
    target:
      device_id: aa1e532da567f3e46f9253fc839e7ec2
    data:
      transition: 5
  - wait_for_trigger:
    - type: no_motion
      platform: device
      device_id: 24ba3139aa039e754aa5e126a868c1f5
      entity_id: binary_sensor.pir_hall
      domain: binary_sensor
      for:
        hours: 0
        minutes: 1
        seconds: 0
  - type: turn_off
    device_id: aa1e532da567f3e46f9253fc839e7ec2
    entity_id: light.gang_loftlys
    domain: light
  mode: restart
- id: '1616055451211'
  alias: Light - Bathroom - Motion
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: bbf250698a4a53bbca8c2b5e919cc617
    entity_id: binary_sensor.pir_bathroom
    domain: binary_sensor
  condition:
  - condition: state
    entity_id: group.any_home
    state: home
    alias: Confirm Any At Home
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.toilet
    data: {}
  - wait_for_trigger:
    - type: no_motion
      platform: device
      device_id: bbf250698a4a53bbca8c2b5e919cc617
      entity_id: binary_sensor.pir_bathroom
      domain: binary_sensor
      for:
        hours: 0
        minutes: 5
        seconds: 0
  - choose:
    - conditions:
      - condition: state
        entity_id: switch.toilet_fan
        state: 'on'
        for:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 0
      sequence:
      - delay:
          hours: 0
          minutes: 30
          seconds: 0
          milliseconds: 0
    default: []
  - service: switch.turn_off
    target:
      entity_id: switch.toilet
    data: {}
  mode: restart
- id: '1632209322025'
  alias: Auto - Detect low battery and notify
  description: ''
  use_blueprint:
    path: sbyx/low-battery-level-detection-notification-for-all-battery-sensors.yaml
    input:
      threshold: 25
      time: '17:00:00'
      exclude:
        entity_id:
        - sensor.mtopnord2_battery_level
      actions:
      - service: notify.mobile_app_mtopnord2
        data:
          message: 'Low battery detected on: {{sensors}}'
- id: '1633628292945'
  alias: Auto - Turn on candles when sun goes down
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
    from: above_horizon
    to: below_horizon
  condition:
  - condition: state
    entity_id: group.any_home
    state: home
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.store_stearinlys
  mode: single
- id: '1634541207719'
  alias: TTS - ChatGPT - Greeting when coming home
  description: ''
  trigger:
  - platform: state
    entity_id: person.malene_trab
    to: home
  condition:
  - condition: time
    after: 09:00:00
    before: '21:00:00'
  action:
  - wait_for_trigger:
    - type: opened
      platform: device
      device_id: f717a0cbeca42322e0440d68a708e8ef
      entity_id: 8218e5d12b3e697845ab7fc4467d1b09
      domain: binary_sensor
    continue_on_timeout: false
    timeout: 00:05:00
  - service: conversation.process
    data:
      agent_id: 566e2ddad12ef92916ee7b102fe86f43
      text: '{% from ''random_tts.jinja'' import tts %} {{ tts() }} der byder velkommen
        hjem {{[''til husets dronningen'',''til Malene'',''fordi man har været savnet'','''']|random()}}'
    response_variable: chatgpt
  - wait_for_trigger:
    - type: motion
      platform: device
      device_id: 7565b2d2c98ed8355cac357b12cfd5ea
      entity_id: 8c73e13bd3ca4ff14d4d400bb58f5392
      domain: binary_sensor
    continue_on_timeout: false
    timeout: 00:05:00
  - service: media_player.volume_set
    data:
      entity_id: media_player.nesthub8311
      volume_level: 0.6
  - service: tts.google_cloud_say
    data_template:
      entity_id: media_player.nesthub8311
      message: <speak>{{chatgpt.response.speech.plain.speech | trim | replace('\"','')}}</speak>
      cache: false
      language: da-DK
      options:
        gender: female
  mode: restart
- id: '1634544242311'
  alias: TTS - ChatGPT - Frontdoor is open
  description: Reminding to close the frontdoor
  trigger:
  - platform: time
    at: '21:00'
  condition:
  - type: is_open
    condition: device
    device_id: f717a0cbeca42322e0440d68a708e8ef
    entity_id: 8218e5d12b3e697845ab7fc4467d1b09
    domain: binary_sensor
  action:
  - service: sonos.snapshot
    data:
      with_group: true
      entity_id: media_player.stue
  - service: conversation.process
    data:
      agent_id: 566e2ddad12ef92916ee7b102fe86f43
      text: '{% from ''random_tts.jinja'' import tts %} {{ tts() }} for at huske at
        lukke døren {{ [''for at holde varmen inde'',''holde insekterne ude'',''holde
        varmen inde og insekterne ude''] | random() }}'
    response_variable: chatgpt
  - service: media_player.volume_set
    data:
      entity_id: media_player.stue
      volume_level: 0.3
  - service: tts.google_cloud_say
    data_template:
      entity_id: media_player.stue
      message: <speak>{{chatgpt.response.speech.plain.speech | trim | replace('\"','')}}</speak>
      cache: false
      language: da-DK
      options:
        gender: female
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: sonos.restore
    data:
      with_group: true
      entity_id: media_player.stue
  mode: single
- id: '1637156442232'
  alias: Auto - Work From Home?
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.work_from_home
    id: cal
  - platform: state
    entity_id: binary_sensor.workday_sensor
    to: 'off'
    id: wds
  - platform: time
    at: 00:00:00
    id: time
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: cal
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: calendar.work_from_home
            state: 'on'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.is_home
            data: {}
        - conditions:
          - condition: state
            entity_id: binary_sensor.workday_sensor
            state: 'on'
          - condition: state
            entity_id: calendar.work_from_home
            state: 'off'
          sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.is_home
            data: {}
        default: []
    - conditions:
      - condition: trigger
        id: wds
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'off'
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.is_home
        data: {}
    - conditions:
      - condition: trigger
        id: time
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: calendar.work_from_home
            state: 'on'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.is_home
            data: {}
        - conditions:
          - condition: state
            entity_id: binary_sensor.workday_sensor
            state: 'on'
          - condition: state
            entity_id: calendar.work_from_home
            state: 'off'
          sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.is_home
            data: {}
        default:
        - service: input_boolean.turn_off
          target:
            entity_id: input_boolean.is_home
          data: {}
    default:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.is_home
      data: {}
  mode: single
- id: '1637178851136'
  alias: Alert - WAN and VPN connections statechange
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.wan_connection
  - platform: state
    entity_id: binary_sensor.vpn_horsensvej
  - platform: state
    entity_id: binary_sensor.vpn_ivan
  condition:
  - condition: template
    value_template: '{{ trigger.to_state.state != trigger.from_state.state }}'
  action:
  - service: notify.mobile_app_mtopnord2
    data_template:
      message: '{{ trigger.from_state.name }} skiftede fra {{ trigger.from_state.state
        }} til {{ trigger.to_state.state }}'
  mode: queued
  max: 10
- id: '1637443580844'
  alias: Auto - Kia Niro - Travel Time - Origin Update
  description: ''
  trigger:
  - platform: state
    entity_id: device_tracker.mtopnord2
    attribute: latitude
  - platform: state
    entity_id: device_tracker.mtopnord2
    attribute: longitude
  - platform: state
    entity_id: device_tracker.mtopnord2
  condition: []
  action:
  - service: input_text.set_value
    target:
      entity_id: input_text.google_origin
    data:
      value: "{% if states(\"device_tracker.mtopnord2\") == \"not_home\" %}\n  {{
        state_attr(\"device_tracker.mtopnord2\", \"latitude\") }}, {{state_attr(\"device_tracker.mtopnord2\",
        \"longitude\") }}\n{% else %}\n  {{ states(\"device_tracker.mtopnord2\") }}\n{%
        endif %}"
  mode: restart
- id: '1637574947818'
  alias: Notification - Remind Departure
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.time_until_departure
    to: '10'
  condition: []
  action:
  - service: notify.mobile_app_mtopnord2
    data:
      message: Du skal afsted om 10 minutter
      data:
        title: Det er ved at være tid til afgang
        importance: high
        channel: calendar_departure
        vibrationPattern: 50, 500, 50, 500, 50, 500, 50, 500
  mode: single
- id: '1638190307088'
  alias: Notification - Medical reminder - Morning
  description: ''
  use_blueprint:
    path: Aohzan/medication_reminder.yaml
    input:
      logbook_message_no_answer: No Morning Medication Answer Time Out
      reminder_time: 06:30:00
      notify_device: 5a203dc793181fba91d8220b160558c1
      input_boolean: input_boolean.husket_medicin_morgen
      notification_title: Husk medicin
      notification_message: Det er tid til at tage din medicin
      notification_action_taken: Taget
      notification_action_later: Spørg senere
      notification_action_skip: ''
      logbook_message_remind: Morning Medication Reminder Sent
      logbook_message_taken: Morning Medication Taken
      logbook_message_later: Postpone Morning Medication Reminder
      logbook_message_skip: Morning Medication Reminder Skipped
      ask_later_wait_time: 60
- id: '1640082213543'
  alias: TTS - ChatGPT - Dinner
  description: Påmindelse for aftensmad
  trigger:
  - platform: time
    at: '17:30'
  condition: []
  action:
  - service: sonos.snapshot
    data:
      with_group: true
      entity_id: media_player.stue
  - service: conversation.process
    data:
      agent_id: 566e2ddad12ef92916ee7b102fe86f43
      text: '{% from ''random_tts.jinja'' import tts %} {{ tts() }} om at huske at
        lave {{ [''mad'',''aftensmad'',''noget at spise''] | random() }}.'
    response_variable: chatgpt
  - service: media_player.volume_set
    data:
      entity_id: media_player.stue
      volume_level: 0.3
  - service: tts.google_cloud_say
    data_template:
      entity_id: media_player.stue
      message: <speak>{{chatgpt.response.speech.plain.speech | trim | replace('\"','')}}</speak>
      cache: false
      language: da-DK
      options:
        gender: female
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
    enabled: true
  - wait_template: '{{ states(''media_player.stue'') != "playing" }}'
    continue_on_timeout: true
    enabled: false
  - service: sonos.restore
    data:
      with_group: true
      entity_id: media_player.stue
  mode: single
- id: '1640082318900'
  alias: TTS - ChatGPT - Water the flowers
  description: Påmindelse at vande blomsterne
  trigger:
  - platform: time
    at: '21:00'
  condition:
  - condition: time
    weekday:
    - sun
  action:
  - service: sonos.snapshot
    data:
      with_group: true
      entity_id: media_player.stue
  - service: conversation.process
    data:
      agent_id: 566e2ddad12ef92916ee7b102fe86f43
      text: '{% from ''random_tts.jinja'' import tts %} {{ tts() }} at huske at vande
        blomsterne'
    response_variable: chatgpt
  - service: media_player.volume_set
    data:
      entity_id: media_player.stue
      volume_level: 0.3
  - service: tts.google_cloud_say
    data_template:
      entity_id: media_player.stue
      message: <speak>{{chatgpt.response.speech.plain.speech | trim | replace('\"','')}}</speak>
      cache: false
      language: da-DK
      options:
        gender: female
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: sonos.restore
    data:
      with_group: true
      entity_id: media_player.stue
  mode: single
- id: '1641207894004'
  alias: TTS - Calendar Notification
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.automations
    id: TTS
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: calendar.automations
    state: TTS
    attribute: message
  action:
  - service: script.do_speech
    data:
      device: livingroom
      call_interrupt: 1
      call_remind: 1
      call_custom: 1
      custom_text: '{{ state_attr("calendar.automations","description") }}'
  mode: single
- id: '1642950827716'
  alias: Auto - Actions at morning alarm when working at home
  description: ''
  trigger:
  - platform: time
    at: sensor.google_sovevaerelse_alarms
  condition:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  - condition: state
    entity_id: input_boolean.is_home
    state: 'on'
  action:
  - wait_for_trigger:
    - type: motion
      platform: device
      device_id: 24ba3139aa039e754aa5e126a868c1f5
      entity_id: 775c74fbe4e193f131d031f52243a75b
      domain: binary_sensor
    timeout: 01:00:00
    continue_on_timeout: false
  - service: switch.turn_on
    target:
      entity_id: switch.toilet
    data: {}
  - type: turn_on
    device_id: 3b6afdd5aff2138e80230367beebc215
    entity_id: switch.kaffemaskine_power
    domain: switch
  - service: switch.turn_on
    target:
      entity_id:
      - switch.pc
      - switch.skrivebord
    data: {}
  - service: media_player.play_media
    data:
      media_content_id: http://live-icy.dr.dk/A/A14H.mp3
      media_content_type: music
    target:
      entity_id: media_player.stue
  - service: media_player.join
    data:
      group_members:
      - media_player.sonos_spisestue
    target:
      entity_id: media_player.stue
  - service: media_player.volume_mute
    data:
      is_volume_muted: false
    target:
      entity_id: media_player.stue
  - service: light.turn_on
    target:
      entity_id:
      - light.spisebord
      - light.kitchen
    data: {}
  mode: single
- id: '1642951260065'
  alias: Auto - 3D Print - Turn off when job is done
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.core_a8_printing
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    id: core-a8
  - platform: state
    entity_id:
    - binary_sensor.anet_a8_printing
    id: anet-a8
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: core-a8
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.core_a8_power
    - conditions:
      - condition: trigger
        id: anet-a8
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.anet_a8_mains
  mode: parallel
  max: 5
- id: '1645621979465'
  alias: Infopanel - Update events
  description: ''
  trigger:
  - platform: time_pattern
    minutes: '30'
    id: recurring
  - platform: homeassistant
    event: start
    id: ha_start
  condition: []
  action:
  - if:
    - condition: trigger
      id:
      - ha_start
    then:
    - delay:
        hours: 0
        minutes: 0
        seconds: 15
        milliseconds: 0
  - service: pyscript.infopanel_get_calendar_event
    data:
      count: 3
  mode: single
- id: '1645947896203'
  alias: Notification - Camera detected motion
  description: ''
  trigger:
  - platform: mqtt
    topic: frigate/events
  condition:
  - condition: template
    value_template: '{% set lastChange = as_timestamp(states.binary_sensor.dw_frontdoor_contact.last_changed,
      0) %}

      {{ (now() - timedelta(minutes=2)).timestamp() > lastChange }}'
  - condition: template
    value_template: '{{ trigger.payload_json[''after''][''camera''] == ''door'' }}'
  - condition: template
    value_template: '{{ trigger.payload_json[''after''][''top_score''] > 0.79 }}'
  action:
  - service: notify.mobile_app_mtopnord2
    data:
      message: Person registreret
      title: Der blev registreret en person ved døren
      data:
        image: /api/frigate/notifications/{{trigger.payload_json["after"]["id"]}}/thumbnail.jpg?format=android
        tag: '{{trigger.payload_json["after"]["id"]}}'
        when: '{{trigger.payload_json["after"]["start_time"]|int}}'
        ttl: 0
        clickAction: /frontdoor-cam/0
  mode: single
- id: '1646049336210'
  alias: Notification - Medical reminder - Evening
  description: ''
  use_blueprint:
    path: Aohzan/medication_reminder.yaml
    input:
      logbook_message_no_answer: No Evening Medication Answer Time Out
      reminder_time: '18:00:00'
      notify_device: 5a203dc793181fba91d8220b160558c1
      input_boolean: input_boolean.husket_medicin_aften
      notification_title: Husk medicin
      notification_message: Det er tid til at tage din medicin
      notification_action_taken: Taget
      notification_action_later: Spørg senere
      notification_action_skip: ''
      logbook_message_remind: Evening Medication Reminder Sent
      logbook_message_taken: Evening Medication Taken
      logbook_message_later: Postpone Evening Medication Reminder
      logbook_message_skip: Evening Medication Reminder Skipped
      ask_later_wait_time: 60
- id: '1646160179333'
  alias: Light - Livingroom - Wallswitch
  description: ''
  trigger:
  - device_id: 313c7e26b66b3bc0afecb70b846d820b
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
    id: 'on'
  - device_id: 313c7e26b66b3bc0afecb70b846d820b
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_off
    id: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.desktop
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - type: toggle
        device_id: 0179248391cdf4e263909ad5bc67e23e
        entity_id: light.deathstar
        domain: light
    default: []
  mode: parallel
  max: 5
- id: '1646161061514'
  alias: Light - Diningroom
  description: ''
  trigger:
  - device_id: c7191429c1bd2426c678ef55d9e5e5e8
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
    id: 'on'
  - device_id: c7191429c1bd2426c678ef55d9e5e5e8
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_off
    id: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: light.turn_on
        data: {}
        target:
          entity_id: light.spisebord
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.spisebord
    default: []
  mode: single
- id: '1646572919441'
  alias: Auto - Climate - Toggle Climate When Window Opens
  description: ''
  trigger:
  - platform: state
    entity_id: group.dw_bedroom
    id: bedroom
    for:
      hours: 0
      minutes: 5
      seconds: 0
    enabled: true
  - platform: state
    entity_id:
    - binary_sensor.dw_bathroom
    id: toilet
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - platform: state
    entity_id:
    - binary_sensor.dw_frontdoor
    id: hall
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - platform: state
    entity_id: group.dw_kitchen
    id: kitchen
    for:
      hours: 0
      minutes: 1
      seconds: 0
  - platform: state
    entity_id: group.dw_diningroom
    id: diningroom
    for:
      hours: 0
      minutes: 1
      seconds: 0
  - platform: state
    entity_id: group.dw_livingroom
    id: livingroom
    for:
      hours: 0
      minutes: 1
      seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.summer_mode
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: livingroom
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: group.dw_livingroom
            state: 'on'
          sequence:
          - service: climate.turn_off
            data: {}
            target:
              device_id: eb8fa3cd070d11eb93e1f3123b152cc3
        default:
        - service: climate.turn_on
          data: {}
          target:
            device_id: eb8fa3cd070d11eb93e1f3123b152cc3
    - conditions:
      - condition: trigger
        id: bedroom
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: group.dw_bedroom
            state: 'on'
          sequence:
          - service: climate.set_hvac_mode
            data:
              hvac_mode: 'off'
            target:
              entity_id: climate.bedroom
        default:
        - service: climate.set_hvac_mode
          data:
            hvac_mode: auto
          target:
            entity_id: climate.bedroom
    - conditions:
      - condition: trigger
        id: toilet
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.dw_bathroom
            state: 'on'
          sequence:
          - service: climate.set_hvac_mode
            data:
              hvac_mode: 'off'
            target:
              entity_id: climate.toilet
        default:
        - service: climate.set_hvac_mode
          data:
            hvac_mode: auto
          target:
            entity_id: climate.toilet
    - conditions:
      - condition: trigger
        id: hall
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.dw_frontdoor
            state: 'on'
          sequence:
          - service: climate.set_hvac_mode
            data:
              hvac_mode: 'off'
            target:
              entity_id: climate.hall
          - service: climate.turn_off
            data: {}
            target:
              device_id: dcda4e53071311eb96e5c56d002656e1
        default:
        - service: climate.set_hvac_mode
          data:
            hvac_mode: auto
          target:
            entity_id: climate.hall
        - service: climate.turn_on
          data: {}
          target:
            device_id: dcda4e53071311eb96e5c56d002656e1
    - conditions:
      - condition: trigger
        id: kitchen
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: group.dw_kitchen
            state: 'on'
          sequence:
          - service: climate.turn_off
            data: {}
            target:
              device_id: dcda4e53071311eb96e5c56d002656e1
        default:
        - service: climate.turn_on
          data: {}
          target:
            device_id: dcda4e53071311eb96e5c56d002656e1
    - conditions:
      - condition: trigger
        id: diningroom
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: group.dw_diningroom
            state: 'on'
          sequence:
          - service: climate.turn_off
            data: {}
            target:
              device_id: dcdb16b4071311eb8ae06bbcb7b0ee4d
        default:
        - service: climate.turn_on
          data: {}
          target:
            device_id: dcdb16b4071311eb8ae06bbcb7b0ee4d
    default: []
  mode: queued
- id: '1646753316288'
  alias: Notification - Person detected
  description: ''
  use_blueprint:
    path: hunterjm/frigate_notification.yaml
    input:
      camera: Door
      notify_device: 5a203dc793181fba91d8220b160558c1
      notify_group: FrontdoorCam
- id: '1647420649275'
  alias: Auto - Set DND mode on mobile phone
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.silence
    id: 'on'
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: calendar.silence
    id: 'off'
    from: 'on'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: notify.mobile_app_mtopnord2
        data:
          message: command_dnd
          title: total_silence
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: notify.mobile_app_mtopnord2
        data:
          message: command_dnd
          title: 'off'
    default: []
  mode: single
- id: '1649146214519'
  alias: Vacuum - Automate run and dock
  description: ''
  trigger:
  - platform: state
    entity_id:
    - group.any_home
    to: not_home
    from: home
    for:
      hours: 0
      minutes: 30
      seconds: 0
    id: run
  - platform: state
    entity_id: group.any_home
    from: not_home
    to: home
    id: dock
  - platform: template
    value_template: "{% if trigger %}\n  {% set direction = trigger.to_state.attributes.dir_of_travel
      %}\n  {% set distance = trigger.to_state.state %}\n\n  {% if direction == towards
      and distance < 15 %}\n    true\n  {% else %}\n    false\n  {% endif %}\n{% endif
      %}"
    id: dock
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: run
      sequence:
      - device_id: db6d034e17793357be5133ee64e87489
        domain: vacuum
        entity_id: vacuum.wall_e
        type: clean
      - service: vacuum.set_fan_speed
        data:
          fan_speed: strong
        target:
          entity_id: vacuum.wall_e
    default:
    - condition: trigger
      id: dock
    - device_id: db6d034e17793357be5133ee64e87489
      domain: vacuum
      entity_id: vacuum.wall_e
      type: dock
  mode: restart
- id: '1653227679389'
  alias: Climate - Summer Mode
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.summer_mode
    from: 'off'
    to: 'on'
    id: 'on'
  - platform: state
    entity_id:
    - input_boolean.summer_mode
    from: 'on'
    to: 'off'
    id: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: climate.turn_off
        data: {}
        target:
          entity_id:
          - climate.stue
          - climate.kokken
          - climate.spisestue
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: climate.turn_on
        data: {}
        target:
          entity_id:
          - climate.stue
          - climate.kokken
          - climate.spisestue
  mode: single
- id: '1670269254038'
  alias: Auto - Blinds - Close
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: 0
    id: sunset
  - platform: time
    at: '17:00:00'
    id: time
  condition: []
  action:
  - if:
    - condition: time
      before: '17:00:00'
      alias: Before 18:00 then wait until 18:00
    then:
    - wait_for_trigger:
      - platform: time
        at: '17:00:00'
    alias: If before 17:00 then wait until 17:00
  - if:
    - condition: sun
      before: sunset
    then:
    - wait_for_trigger:
      - platform: sun
        event: sunset
        offset: 0
    alias: Wait until sunset occurs
  - service: cover.close_cover
    data: {}
    target:
      entity_id: cover.alle_gardiner
  mode: single
- id: '1670270053658'
  alias: Auto - Blinds - Open at 7:00
  description: ''
  trigger:
  - platform: time
    at: 07:00:00
    id: time
  condition: []
  action:
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.alle_gardiner
  mode: single
- id: '1672253327159'
  alias: Notify - Update Kuma
  description: ''
  trigger:
  - platform: event
    event_type: call_service
    event_data:
      domain: notify
      service: notify
      service_data:
        title: Uptime Kuma
        data:
          status: 0
          name: Rust
  condition: []
  action:
  - service: notify.persistent_notification
    data:
      message: Rust went down
  - service: notify.mobile_app_mtopnord2
    data:
      message: Rust serveren gik ned
      title: Rust er nede
  mode: single
- id: '1674819619269'
  alias: Light - Turn off outside 1 hour past dawn if on
  description: ''
  trigger:
  - platform: sun
    event: sunrise
    offset: 01:00:00
  condition:
  - condition: device
    type: is_on
    device_id: 80cb35c383ad7ab431957c4800c3573d
    entity_id: light.outside_1
    domain: light
  action:
  - type: turn_off
    device_id: 80cb35c383ad7ab431957c4800c3573d
    entity_id: light.outside_1
    domain: light
  mode: single
- id: '1681199186648'
  alias: TTS - ChatGPT - Bedtime
  description: ''
  trigger:
  - platform: time
    at: input_datetime.bedtime
  condition:
  - condition: state
    entity_id: person.malene_trab
    state: home
  - condition: state
    entity_id: binary_sensor.workday_tomorrow
    state: 'on'
  - condition: or
    conditions:
    - condition: state
      entity_id: sensor.google_sovevaerelse_alarms
      state: unavailable
    - condition: state
      entity_id: sensor.google_sovevaerelse_alarms
      state: unknown
  action:
  - service: sonos.snapshot
    data:
      with_group: true
      entity_id: media_player.stue
  - service: conversation.process
    data:
      agent_id: 566e2ddad12ef92916ee7b102fe86f43
      text: '{% from ''random_tts.jinja'' import tts %} {{ tts() }} om at det er sengetid.'
    response_variable: chatgpt
  - service: media_player.volume_set
    data:
      volume_level: 0.25
    enabled: true
    target:
      entity_id: media_player.stue
  - service: tts.google_cloud_say
    data_template:
      entity_id: media_player.stue
      message: <speak>{{chatgpt.response.speech.plain.speech | trim | replace('\"','')}}</speak>
      cache: false
      language: da-DK
      options:
        gender: female
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: sonos.restore
    data:
      with_group: true
      entity_id: media_player.stue
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.google_sovevaerelse_alarms
        state: unavailable
      sequence:
      - service: script.go_to_bed_reminder
        data: {}
    default: []
  mode: restart
- id: '1681207362051'
  alias: TTS - ChatGPT - Departure Time
  description: ''
  trigger:
  - platform: time
    at: input_datetime.car_departure_time
  condition:
  - condition: state
    entity_id: input_boolean.charge_time_override
    state: 'on'
  action:
  - service: conversation.process
    data:
      agent_id: 566e2ddad12ef92916ee7b102fe86f43
      text: '{% from ''random_tts.jinja'' import tts %} {{ tts() }} om at jeg skal
        afsted nu.'
    response_variable: chatgpt
  - service: media_player.volume_set
    data:
      entity_id: media_player.nesthub8311
      volume_level: 0.6
  - service: tts.google_cloud_say
    data_template:
      entity_id: media_player.nesthub8311
      message: <speak>{{chatgpt.response.speech.plain.speech | trim | replace('\"','')}}</speak>
      cache: false
      language: da-DK
      options:
        gender: female
  mode: single
- id: '1681208450554'
  alias: TTS - ChatGPT - DJ Skoge stream
  description: Giv besked når Skoge streamer
  trigger:
  - platform: state
    entity_id: sensor.djskoge
    from: offline
    to: streaming
    for:
      hours: 0
      minutes: 0
      seconds: 30
  condition:
  - condition: time
    after: '10:00:00'
    before: '22:00:00'
  action:
  - service: sonos.snapshot
    data:
      with_group: true
      entity_id: media_player.stue
  - service: conversation.process
    data:
      agent_id: 566e2ddad12ef92916ee7b102fe86f43
      text: '{% from ''random_tts.jinja'' import tts %} {{ tts() }} om at tænde for
        DJ Skoges Twitch-stream.'
    response_variable: chatgpt
  - service: media_player.volume_set
    data:
      entity_id: media_player.stue
      volume_level: 0.3
  - service: tts.google_cloud_say
    data_template:
      entity_id: media_player.stue
      message: <speak>{{chatgpt.response.speech.plain.speech | trim | replace('\"','')}}</speak>
      cache: false
      language: da-DK
      options:
        gender: female
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: sonos.restore
    data:
      with_group: true
      entity_id: media_player.stue
  mode: single
- id: '1683624735066'
  alias: Auto - Close cover in livingroom when sun is on
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.livingroom_sun
  condition:
  - condition: and
    conditions:
    - condition: sun
      before: sunset
    - condition: sun
      after: sunrise
    - condition: not
      conditions:
      - condition: state
        entity_id: cover.rullegardin_spisestue
        state: closed
  action:
  - service: cover.set_cover_position
    data_template:
      position: '{{ states("sensor.livingroom_sun") }}'
    target:
      entity_id: cover.rullegardin_spisestue
  mode: single
- id: '1684152370872'
  alias: Auto - Update UV Index when sun is 10 degrees above horizon
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /20
  condition:
  - condition: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    above: 10
  action:
  - service: homeassistant.update_entity
    data: {}
    target:
      entity_id: sensor.current_uv_index
  mode: single
- id: '1687369590504'
  alias: State - Water Valve manual switch
  description: ''
  trigger:
  - device_id: 16a78929ea02ecd08640f5b26bb1e30f
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
  - device_id: 16a78929ea02ecd08640f5b26bb1e30f
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_off
  condition: []
  action:
  - type: toggle
    device_id: df0febec5fa1eef2697dab361114ef6e
    entity_id: 40ccafae661f7e9952373e8feafe8dcb
    domain: switch
  mode: single
- id: '1691498227535'
  alias: Auto - Light and Cover on TV state
  description: ''
  trigger:
  - platform: device
    device_id: 816e9da3f08029af2095292d2960106e
    domain: media_player
    entity_id: c95a5305c7d74751bf36458c1c2bfdc6
    type: paused
    id: pause
    enabled: true
  - platform: state
    entity_id:
    - media_player.android_tv
    to: paused
    id: pause
  - platform: state
    entity_id:
    - media_player.android_tv
    to: playing
    id: play
  - platform: state
    entity_id:
    - media_player.android_tv
    to: buffering
    id: play
  - platform: state
    entity_id:
    - media_player.android_tv
    to: 'off'
    id: stop
    from: playing
  - platform: state
    entity_id:
    - media_player.android_tv
    to: 'off'
    id: stop
    from: paused
  - platform: state
    entity_id:
    - media_player.android_tv
    to: 'off'
    id: stop
    from: buffering
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: media_player.android_tv
      attribute: app_id
      state: tv.twitch.android.app
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - play
      sequence:
      - service: light.turn_off
        data: {}
        target:
          device_id: 0179248391cdf4e263909ad5bc67e23e
          entity_id: light.desktop
      - service: cover.close_cover
        data: {}
        target:
          area_id: 8868a1b304c411eb9211dd814829b168
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - pause
        - condition: or
          conditions:
          - condition: sun
            before: sunrise
          - condition: sun
            after: sunset
      sequence:
      - service: light.turn_on
        data:
          transition: 3
          brightness_pct: 30
        target:
          device_id: 0179248391cdf4e263909ad5bc67e23e
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - stop
        - condition: sun
          after: sunrise
          before: sunset
      sequence:
      - service: cover.open_cover
        data: {}
        target:
          area_id: 8868a1b304c411eb9211dd814829b168
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - stop
        - condition: or
          conditions:
          - condition: sun
            before: sunrise
          - condition: sun
            after: sunset
      sequence:
      - service: light.turn_on
        data:
          transition: 5
          brightness_pct: 50
        target:
          device_id: 0179248391cdf4e263909ad5bc67e23e
  mode: single
- id: '1694260829982'
  alias: Notification - Medical reminder - Lunch
  description: ''
  use_blueprint:
    path: Aohzan/medication_reminder.yaml
    input:
      logbook_message_no_answer: No Lunch Medication Answer Time Out
      reminder_time: '12:00:00'
      notify_device: 5a203dc793181fba91d8220b160558c1
      input_boolean: input_boolean.husket_medicin_middag
      notification_title: Husk medicin
      notification_message: Det er tid til at tage din medicin
      notification_action_taken: Taget
      notification_action_later: Spørg senere
      notification_action_skip: ''
      logbook_message_remind: Lunch Medication Reminder Sent
      logbook_message_taken: Lunch Medication Taken
      logbook_message_later: Postpone Lunch Medication Reminder
      logbook_message_skip: Lunch Medication Reminder Skipped
      ask_later_wait_time: 60
- id: '1694260934493'
  alias: Notification - Medical reminder - Afternoon
  description: ''
  use_blueprint:
    path: Aohzan/medication_reminder.yaml
    input:
      logbook_message_no_answer: No Afternoon Medication Answer Time Out
      reminder_time: '14:00:00'
      notify_device: 5a203dc793181fba91d8220b160558c1
      input_boolean: input_boolean.husket_medicin_eftermiddag
      notification_title: Husk medicin
      notification_message: Det er tid til at tage din medicin
      notification_action_taken: Taget
      notification_action_later: Spørg senere
      notification_action_skip: ''
      logbook_message_remind: Afternoon Medication Reminder Sent
      logbook_message_taken: Afternoot Medication Taken
      logbook_message_later: Postpone Afternoon Medication Reminder
      logbook_message_skip: Afternoon Medication Reminder Skipped
      ask_later_wait_time: 60
- id: '1694261007782'
  alias: Notification - Medical reminder - Night
  description: ''
  use_blueprint:
    path: Aohzan/medication_reminder.yaml
    input:
      logbook_message_no_answer: No Night Medication Answer Time Out
      reminder_time: '22:00:00'
      notify_device: 5a203dc793181fba91d8220b160558c1
      input_boolean: input_boolean.husket_medicin_nat
      notification_title: Husk medicin
      notification_message: Det er tid til at tage din medicin
      notification_action_taken: Taget
      notification_action_later: Spørg senere
      notification_action_skip: ''
      logbook_message_remind: Night Medication Reminder Sent
      logbook_message_taken: Night Medication Taken
      logbook_message_later: Postpone Night Medication Reminder
      logbook_message_skip: Night Medication Reminder Skipped
      ask_later_wait_time: 60
- id: '1695198715635'
  alias: Notification - Medical reminder - HRT
  description: ''
  use_blueprint:
    path: mtrab/medication_reminder_weekday.yaml
    input:
      reminder_time: '19:00:00'
      notify_device: 5a203dc793181fba91d8220b160558c1
      input_boolean: input_boolean.husket_medicin_hormon_plaster
      notification_title: Husk at skifte hormon plaster
      notification_message: Du skal skifte hormon plaster
      notification_action_taken: Skiftet
      notification_action_later: Senere
      logbook_message_remind: Hormon plaster reminder sendt
      logbook_message_taken: Hormon plaster skiftet
      logbook_message_later: Hormon plaster skift udsat
      logbook_message_no_answer: Hormon plaster reminder sendt igen
      optional_action: []
- id: '1695223744047'
  alias: Light - Dimming Desktop
  description: ''
  use_blueprint:
    path: mtrab/ZHA - IKEA on off dimmer.yaml
    input:
      remote: 0c217534fa16479f6fe7d4c595edea3d
      light:
        device_id: 1e97980e04e111eb800287a8184cbf3d
- id: '1695223866267'
  alias: Light - Dimming - Diningtable
  description: ''
  use_blueprint:
    path: mtrab/ZHA - IKEA on off dimmer.yaml
    input:
      remote: c7191429c1bd2426c678ef55d9e5e5e8
      light:
        device_id: 5e2dcf9304e111eb9a30e3199109ec3d
- id: '1695583504741'
  alias: MagicMirror - Dim Screen
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_number.magicmirror_screen_brightness
  condition: []
  action:
  - service: rest_command.dim_mm_screen
    data: {}
  mode: single
- id: '1696515470263'
  alias: Notification - Extra Freezer Temperature
  description: ''
  trigger:
  - device_id: 83f76589b1625127d4f7d5f520763fd5
    domain: zha
    platform: device
    type: device_offline
    subtype: device_offline
    id: offline
  - type: temperature
    platform: device
    device_id: 83f76589b1625127d4f7d5f520763fd5
    entity_id: 0917becc67d94a8b300cb5b2d0ba8abf
    domain: sensor
    id: high
    above: -10
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - type: temperature
    platform: device
    device_id: 83f76589b1625127d4f7d5f520763fd5
    entity_id: 0917becc67d94a8b300cb5b2d0ba8abf
    domain: sensor
    id: low
    below: -25
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - offline
      sequence:
      - service: notify.mobile_app_mtopnord2
        data:
          message: Extra fryser sensor er offline!
          title: Sensor offline
    - conditions:
      - condition: trigger
        id:
        - high
      sequence:
      - service: notify.mobile_app_mtopnord2
        data:
          message: Temperatur i extra fryser er for høj!
          title: '!! FOR HØJ TEMPERATUR I FRYSEREN !!'
    - conditions:
      - condition: trigger
        id:
        - low
      sequence:
      - service: notify.mobile_app_mtopnord2
        data:
          message: Temperaturen i extra fryser er for lav
          title: For lav temperatur i fryseren
  mode: restart
- id: '1697009564527'
  alias: Auto - Webasto - Get next departure time
  description: Reads next start time from calendar event and deducts travel time
  trigger:
  - platform: state
    entity_id: calendar.heating
    to: 'off'
  - platform: time_pattern
    hours: /1
    minutes: 5
  condition: []
  action:
  - service: input_datetime.set_datetime
    target:
      entity_id: input_datetime.webasto_next_departure_time
    data:
      datetime: '{{ as_datetime(((as_timestamp(state_attr("calendar.heating","start_time"))
        - (states(''sensor.google_travel_time'')|int(0)*60) - (10*60)))|timestamp_local(default=''0''))
        }}

        '
  - service: input_text.set_value
    target:
      entity_id: input_text.google_destination
    data:
      value: "{% if state_attr(\"calendar.heating\", \"location\") != \"\" %}\n  {{
        state_attr(\"calendar.heating\", \"location\") }}\n{% else %}\n  home\n{%
        endif %}\n"
  mode: single
- id: '1697009587979'
  alias: Auto - Webasto - Set next calculated start
  description: Reads the calculated departure time from sensor.webasto_calculated_start
  trigger:
  - platform: state
    entity_id: sensor.webasto_calculated_start
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 2
      milliseconds: 0
  - service: input_datetime.set_datetime
    target:
      entity_id: input_datetime.webasto_calculated_departure_time
    data:
      datetime: "{% if (states('sensor.calculated_run_time') | float(0)) > 0 %}\n
        \ {{ states(\"sensor.webasto_calculated_start\") }}\n{% else %}\n  {{ states(\"input_datetime.webasto_next_departure_time\")
        }}\n{% endif %}\n"
  mode: restart
- id: '1697009611723'
  alias: Auto - Webasto - Turn Off When Getting Near Zone
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: proximity.malene_home
    below: '15'
  condition:
  - condition: state
    entity_id: proximity.malene_home
    state: towards
    attribute: dir_of_travel
  - condition: state
    entity_id: switch.kia_heater
    state: 'on'
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.kia_heater
    data: {}
  mode: single
- id: '1697009634503'
  alias: Auto - Webasto - Turn on at calculated start time
  description: Turns on the heater when input_datetime.webasto_calculated_departure_time
    is reached
  trigger:
  - platform: time
    at: input_datetime.webasto_calculated_departure_time
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ (states(''sensor.kia_temperature'') | float(0)) < (states(''input_number.webasto_low_point'')
        | float(0)) }}'
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.kia_heater
    data: {}
  mode: single
- id: '1697024611595'
  alias: Auto - Webasto - Turn on if at DC Randers
  description: ''
  trigger:
  - platform: template
    value_template: "{% set time_to_leave_mon_thu = \"15:30\" %}\n{% set time_to_leave_fri
      = \"14:00\" %}\n\n{% set dow = now().strftime('%a').lower() %}\n\n{% if (dow
      == \"mon\" or dow == \"tue\" or dow == \"wed\" or dow == \"thu\") %}\n  {% set
      time_to_leave = time_to_leave_mon_thu %}\n{% elif (dow == \"fri\") %}\n  {%
      set time_to_leave = time_to_leave_fri %}\n{% else %}\n  {% set time_to_leave
      = \"weekend\" %}\n{% endif %}\n\n{% if (time_to_leave != \"weekend\") %}\n  {%
      set runtime = states(\"sensor.calculated_run_time\") | int %}\n  {% set departure
      = strptime(time_to_leave + \":00\", \"%H:%M:%S\") - timedelta(minutes=runtime)
      %}\n  {% set dep_time = (departure.hour | string) + \":\" + (departure.minute
      | string) + \":00\" %}\n  {% set now_time = (now().hour | string) + \":\" +
      (now().minute | string) + \":00\" %}\n\n  {{ dep_time == now_time }}\n{% else
      %}\nfalse\n{% endif %}"
  condition:
  - condition: zone
    entity_id: device_tracker.kia_location
    zone: zone.danish_crown_randers_tulipvej
  - condition: state
    entity_id: automation.auto_webasto_turn_on_at_calculated_start_time
    state: 'on'
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.kia_heater
  mode: single
- id: '1697103017804'
  alias: Auto - Actions on HomeAssistant Startup
  description: ''
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - type: turn_off
    device_id: 6de9fe6a5eb1d0abb21bd52d06de2f57
    entity_id: 7206808666e29ba0d092b66448863f16
    domain: switch
  mode: single
- id: '1698919443190'
  alias: Notification - Prepare Dinner
  description: ''
  use_blueprint:
    path: mtrab/advanced_reminder_if_home.yaml
    input:
      person_home: person.malene_trab
      reminder_time: '18:00:00'
      notify_device: 5a203dc793181fba91d8220b160558c1
      input_boolean: input_boolean.dinner_reminder
      notification_title: Det er tid for aftensmad
      notification_message: Husk at du skal lave aftensmad
      notification_action_taken: Igang
      notification_action_later: Senere
      notification_action_skip: Ikke i dag
      logbook_message_remind: Reminder sent for dinner
      logbook_message_taken: Dinner done
      logbook_message_later: Dinner later
      logbook_message_skip: Dinner skipped
      logbook_message_no_answer: No answer time out for dinner reminder
- id: '1699116475988'
  alias: Auto - Update NS1 Glue Record
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.myip
    from:
    to:
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.myip
      state: unknown
    - condition: state
      entity_id: sensor.myip
      state: unavailable
  action:
  - service: shell_command.parsehub_run
    data_template:
      token: tAfPa43Dr0Vp
      key: new_ip
      value: '{{ states(''sensor.myip'') }}'
  - service: notify.mobile_app_mtopnord2
    data:
      message: WAN IP address has changed!
  mode: queued
  max: 10
- id: '1701181049862'
  alias: Auto - Update Kia Niro Location in Traccar Add-On
  description: ''
  trigger:
  - platform: state
    entity_id:
    - device_tracker.kia_location
    attribute: latitude
  - platform: state
    entity_id:
    - device_tracker.kia_location
    attribute: longitude
  condition: []
  action:
  - service: rest_command.update_traccar_niro
    data: {}
  mode: restart
- id: '1701803758766'
  alias: Auto - Update Malenes Location in Traccar Add-On
  description: ''
  trigger:
  - platform: state
    entity_id:
    - device_tracker.mtopnord2
    attribute: latitude
  - platform: state
    entity_id:
    - device_tracker.mtopnord2
    attribute: longitude
  condition: []
  action:
  - service: rest_command.update_traccar_mt_oneplus
    data: {}
  mode: restart
